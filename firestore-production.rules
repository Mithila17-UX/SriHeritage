rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // PRODUCTION RULES: Secure access with proper permissions
    // ðŸ”’ Use these rules when deploying to production
    
    // Sites collection - read for authenticated users, write for admins
    match /sites/{document} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.token.email in [
        'admin@sriheritage.com',
        'mithila_2001@yahoo.com',
        'sanojdesilva24065@gmail.com'
        // Add other admin emails here
      ];
    }

    // Users can only access their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Chat sessions - users can only access their own sessions
    match /chat_sessions/{sessionId} {
      allow read, write, delete: if request.auth != null && 
        request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && 
        request.auth.uid == request.resource.data.userId;
    }

    // Forum posts - read for all authenticated, write for owners/admins
    match /forum_posts/{postId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && 
        (request.auth.uid == resource.data.userId || 
         request.auth.token.email in [
           'admin@sriheritage.com', 
           'mithila_2001@yahoo.com',
           'sanojdesilva24065@gmail.com'
         ]);
      
      // Comments subcollection
      match /comments/{commentId} {
        allow read: if request.auth != null;
        allow create: if request.auth != null;
        allow update, delete: if request.auth != null && 
          (request.auth.uid == resource.data.userId || 
           request.auth.token.email in [
             'admin@sriheritage.com', 
             'mithila_2001@yahoo.com',
             'sanojdesilva24065@gmail.com'
           ]);
      }
    }

    // Forum stats - read for authenticated, write for admins
    match /forum_stats/{document} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && 
        request.auth.token.email in [
          'admin@sriheritage.com', 
          'mithila_2001@yahoo.com',
          'sanojdesilva24065@gmail.com'
        ];
    }

    // Default deny all other access
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
